const cheerio = require('cheerio');

// Tu HTML
const html = `<div class="players"><table><thead></thead><tbody><tr class="starters"><td width="45%"><table width="100%"><tbody><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-es" title="Spain"></div></td><td class="team_number" width="5%">1</td><td class="name" width="30%"><a href="/players/andoni-zubizarreta-urreta" title="Andoni Zubizarreta Urreta"><span itemprop="name">Zubizarreta</span></a></td><td class="age" width="5%">30</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-es" title="Spain"></div></td><td class="team_number" width="5%">2</td><td class="name" width="30%"><a href="/players/albert-ferrer-llopis" title="Albert Ferrer Llopis"><span itemprop="name">Ferrer</span></a></td><td class="age" width="5%">22</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-es" title="Spain"></div></td><td class="team_number" width="5%">3</td><td class="name" width="30%"><a href="/players/miquel-angel-nadal-homar" title="Miquel Àngel Nadal Homar"><span itemprop="name">Nadal</span></a></td><td class="age" width="5%">26</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-es" title="Spain"></div></td><td class="team_number" width="5%">4</td><td class="name" width="30%"><a href="/players/josep-guardiola-sala" title="Josep Guardiola Sala"><span itemprop="name">Guardiola</span></a></td><td class="age" width="5%">21</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-es" title="Spain"></div></td><td class="team_number" width="5%">5</td><td class="name" width="30%"><a href="/players/eusebio-sacristan-mena" title="Eusebio Sacristán Mena"><span itemprop="name">Eusebio</span></a></td><td class="age" width="5%">28</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-hr" title="Croatia"></div></td><td class="team_number" width="5%">6</td><td class="name" width="30%"><a href="/players/goran-vucevic" title="Goran Vučević"><span itemprop="name">Vučević</span></a></td><td class="age" width="5%">21</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-es" title="Spain"></div></td><td class="team_number" width="5%">7</td><td class="name" width="30%"><a href="/players/jon-andoni-goikoetxea-lasa" title="Jon Andoni Goikoetxea Lasa"><span itemprop="name">Goikoetxea</span></a></td><td class="age" width="5%">26</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-es" title="Spain"></div></td><td class="team_number" width="5%">8</td><td class="name" width="30%"><a href="/players/guillermo-amor-martinez" title="Guillermo Amor Martínez"><span itemprop="name">Amor</span></a></td><td class="age" width="5%">24</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-dk" title="Denmark"></div></td><td class="team_number" width="5%">9</td><td class="name" width="30%"><a href="/players/michael-laudrup" title="Michael Laudrup"><span itemprop="name">Laudrup</span></a></td><td class="age" width="5%">28</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-nl" title="Netherlands"></div></td><td class="team_number" width="5%">10</td><td class="name" width="30%"><a href="/players/richard-peter-witschge" title="Richard Peter Witschge"><span itemprop="name">Witschge</span></a></td><td class="age" width="5%">22</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-es" title="Spain"></div></td><td class="team_number" width="5%">11</td><td class="name" width="30%"><a href="/players/aitor-txiki-begiristain-mujika" title="Aitor &quot;Txiki&quot; Begiristain Mujika"><span itemprop="name">Begiristain</span></a></td><td class="age" width="5%">28</td></tr></tbody></table></td><td width="10%"></td><td width="45%"><table width="100%"><tbody><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">1</td><td class="name" width="30%"><a href="/players/lars-gaute-bo" title="Lars Gaute Bø"><span itemprop="name">Bø</span></a></td><td class="age" width="5%">28</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">2</td><td class="name" width="30%"><a href="/players/oyvind-mellemstrand" title="Øyvind Mellemstrand"><span itemprop="name">Mellemstrand</span></a></td><td class="age" width="5%">22</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">3</td><td class="name" width="30%"><a href="/players/ingve-boe" title="Ingve Bøe"><span itemprop="name">Bøe</span></a></td><td class="age" width="5%">27</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">4</td><td class="name" width="30%"><a href="/players/ulf-karlsen" title="Ulf Karlsen"><span itemprop="name">Karlsen</span></a></td><td class="age" width="5%">26</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">5</td><td class="name" width="30%"><a href="/players/roger-nilsen" title="Roger Nilsen"><span itemprop="name">Nilsen</span></a></td><td class="age" width="5%">23</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">6</td><td class="name" width="30%"><a href="/players/erik-stensrud-pedersen" title="Erik Stensrud Pedersen"><span itemprop="name">Pedersen</span></a></td><td class="age" width="5%">24</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">7</td><td class="name" width="30%"><a href="/players/sander-solberg" title="Sander Solberg"><span itemprop="name">Solberg</span></a></td><td class="age" width="5%">20</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">8</td><td class="name" width="30%"><a href="/players/kenneth-storvik" title="Kenneth Storvik"><span itemprop="name">Storvik</span></a></td><td class="age" width="5%">20</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">9</td><td class="name" width="30%"><a href="/players/egil-fjetland" title="Egil Fjetland"><span itemprop="name">Fjetland</span></a></td><td class="age" width="5%">30</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">10</td><td class="name" width="30%"><a href="/players/egil-johan-ostenstad" title="Egil Johan Østenstad"><span itemprop="name">Østenstad</span></a></td><td class="age" width="5%">20</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">11</td><td class="name" width="30%"><a href="/players/borre-meinseth" title="Børre Meinseth"><span itemprop="name">Meinseth</span></a></td><td class="age" width="5%">25</td></tr></tbody></table></td></tr><tr><td colspan="3" height="15px"></td></tr><tr class="coaches"><td width="45%"><table width="100%"><tbody><tr class="player"><td colspan="2"></td><td class="name" colspan="2">Coach</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-nl" title="Netherlands"></div></td><td class="team_number" width="5%"></td><td class="name" width="30%"><a href="/players/hendrick-johannes-johan-cruyff" title="Hendrick Johannes (Johan) Cruyff"><span itemprop="name">Cruijff</span></a></td><td class="age" width="5%">45</td></tr></tbody></table></td><td width="10%"></td><td width="45%"><table width="100%"><tbody><tr class="player"><td colspan="2"></td><td class="name" colspan="2">Coach</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%"></td><td class="name" width="30%"><a href="/players/bjarne-berntsen" title="Bjarne Berntsen"><span itemprop="name">Berntsen</span></a></td><td class="age" width="5%">35</td></tr></tbody></table></td></tr><tr><td colspan="3" height="15px"></td></tr><tr class="reserves"><td style="vertical-align:top;" width="45%"><table width="100%"><tbody><tr class="player"><td colspan="2"></td><td class="name" colspan="2">Substitutes</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-es" title="Spain"></div></td><td class="team_number" width="5%">14</td><td class="name" width="30%"><a href="/players/miquel-soler-sarasols" title="Miquel Soler Sarasols"><span itemprop="name">Soler</span></a></td><td class="age" width="5%">27</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-es" title="Spain"></div></td><td class="team_number" width="5%">16</td><td class="name" width="30%"><a href="/players/julio-salinas-fernandez" title="Julio Salinas Fernández"><span itemprop="name">J. Salinas</span></a></td><td class="age" width="5%">30</td></tr></tbody></table></td><td width="10%"></td><td style="vertical-align:top;" width="45%"><table width="100%"><tbody><tr class="player"><td colspan="2"></td><td class="name" colspan="2">Substitutes</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">13</td><td class="name" width="30%"><a href="/players/alf-kare-tveit" title="Alf Kåre Tveit"><span itemprop="name">Tveit</span></a></td><td class="age" width="5%">25</td></tr><tr class="player" itemprop="competitor" itemscope="" itemtype="http://schema.org/Person"><td class="country" width="5%"><div class="flag flag-no" title="Norway"></div></td><td class="team_number" width="5%">14</td><td class="name" width="30%"><a href="/players/leif-rune-salte" title="Leif Rune Salte"><span itemprop="name">Salte</span></a></td><td class="age" width="5%">25</td></tr></tbody></table></td></tr></tbody></table></div>`;

// Función para convertir la tabla HTML a JSON
const convertirTablaAJSON = (html) => {
  const $ = cheerio.load(html);

  // Array para almacenar los datos
  const equipos = [];

  // Iterar sobre cada equipo
  $('.players table tbody').each((index, equipo) => {
    const equipoObj = {
      team: '',
      players: [],
      substitutes: [],
      coach: '',
    };

    // Obtener el nombre del equipo
    equipoObj.team = $(equipo).find('tr.coaches .name').text();

    // Obtener los jugadores titulares
    $(equipo).find('tr.starters').each((i, titular) => {
      const jugador = {
        name: $(titular).find('.name a span[itemprop="name"]').text(),
        number: $(titular).find('.team_number').text(),
        nationality_url: $(titular).find('.flag').attr('title'),
      };
      equipoObj.players.push(jugador);
    });

    // Obtener los suplentes
    $(equipo).find('tr.reserves').each((i, suplente) => {
      const jugador = {
        name: $(suplente).find('.name a span[itemprop="name"]').text(),
        number: $(suplente).find('.team_number').text(),
        nationality_url: $(suplente).find('.flag').attr('title'),
      };
      equipoObj.substitutes.push(jugador);
    });

    // Obtener el entrenador
    $(equipo).find('tr.coaches').each((i, entrenador) => {
      equipoObj.coach = $(entrenador).find('.name a span[itemprop="name"]').text();
    });

    equipos.push(equipoObj);
  });

  return equipos;
};

// Llamar a la función y obtener el resultado
const resultadoJSON = convertirTablaAJSON(html);

// Imprimir el resultado
console.log(resultadoJSON);
